Dim CurrentDate, dateFromCell, deviceArray, CurrentHour, CurrentMinute, FileName
Dim objFSO, endFlag, checkCounter, pathOfFile2, colorFont, TextToFind, arrLine
Dim i, k, j
On Error Resume Next
Const xlUp = -4162

'Set objFSO = CreateObject("Scripting.FileSystemObject")
'Set objFSO2 = CreateObject("Scripting.FileSystemObject")
'	outFile = "Z:\Рекламации\Flash\Перенос\OTK\VBS\FindComment\outData.xlsx"
'Set objFile = objFSO.CreateTextFile(outFile,True)
Set objExcel = CreateObject("Excel.Application") 
	objExcel.visible = False 

Set objWorkbook1 = objExcel.Workbooks.Open("C:\Users\bezrukov_mg\Documents\FindComment\Поставки и рекламации модулей.xlsx") 
Set objWorkbook2 = objExcel.Workbooks.Open("C:\Users\bezrukov_mg\Documents\FindComment\Поставки.xlsx")
 
Set objSheet1 = objWorkbook1.Worksheets(4)
Set objSheet2 = objWorkbook2.Worksheets(1)

With objSheet1
      checkCounter = .Range("A" & .Rows.Count).End(xlUp).Row
	  MsgBox checkCounter
End With

k = 2
j = 2 
do while (objSheet1.Cells(k,1).Value <> "") or (k = checkCounter)
	i = 4
	do while (objSheet1.Cells(k,i).Value <> "") 'or (i = 5)
		'MsgBox "k - " & k & "i - " & i & "Color - " & objSheet1.Cells(k,i).Interior.ColorIndex	 
		If objSheet1.Cells(k,i).Comment.Text <> "" Then
				TextToFind = objSheet1.Cells(k,i).Comment.Text
		End If	
		
		If (((InStr(TextToFind, "840") > 0) or (InStr(TextToFind, "640") > 0) or (InStr(TextToFind, "БП") > 0)) and (objSheet1.Cells(k,i).Comment.Text <> "")) Then
		
			objSheet2.Cells(j,1).Value = objSheet1.Cells(k,1).Value
			objSheet2.Cells(j,2).Value = objSheet1.Cells(k,2).Value
			objSheet2.Cells(j,3).Value = objSheet1.Cells(k,i).Value
			objSheet2.Cells(j,4).Value = objSheet1.Cells(k,i).Comment.Text
			j = j + 1
		End If
	i = i + 1 
	loop
	
k = k + 1 
loop
objSheet2.Cells(1,1).Value = "ModuleNumber"
objSheet2.Cells(1,2).Value = "DateOfRelease"
objSheet2.Cells(1,3).Value = "DateOfIssue"
objSheet2.Cells(1,4).Value = "Comment"
objExcel.DisplayAlerts = true
objWorkbook1.Close true
objExcel.DisplayAlerts= True
objWorkbook2.Close true

Set objWorkbook1 = Nothing
Set objWorkbook2 = Nothing
 
WScript.Echo "Finished." 
objExcel.Application.Quit 'close excel
WScript.Quit



